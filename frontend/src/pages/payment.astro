---
import App from "@/layouts/App.astro";
import { getI18N } from "@/../i18n/index";
import Layout from "@/layouts/Layout.astro";
import { getSEOData } from "@/utils/seo";
import type { I18nTranslations, PropsSEO } from "@/types/types";
import PaymentPage from "@/components/payment/Payment.astro";

// Obtenemos el idioma obtenido mediante la ruta
const { lang } = Astro.params;
const data = getI18N({ lang }) as I18nTranslations;

// SEO data usando el helper
const currentLang = lang || "es";
const seoData = getSEOData("pricing", currentLang) as PropsSEO;

// Obtener bookingUid de la URL
const bookingUid = Astro.url.searchParams.get("uid") || Astro.url.searchParams.get("bookingUid");

if (!bookingUid) {
  return Astro.redirect("/");
}

// Opcional: Obtener detalles del booking desde Cal.com
// const bookingDetails = await fetchBookingDetails(bookingUid);
---

<Layout
  lang={currentLang}
  title={seoData.title}
  description={seoData.description}
  canonical={seoData.canonical}
  ogImage={seoData.ogImage}
  noindex={seoData.noindex}
  keywords={seoData.keywords}
  structuredDataType={seoData.structuredDataType}
  structuredData={seoData.structuredData}
>
  <App data={data}>
    <PaymentPage bookingUid={bookingUid} />
  </App>
</Layout>
