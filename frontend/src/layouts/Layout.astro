---
import "@/styles/global.css";
import SEO from "../components/SEO/SEO.astro";
import { Toaster } from "solid-toast";
import type { PropsSEO } from "../types/types";

declare global {
  interface Window {
    turnstile?: any;
    JustValidate?: any;
    handlePaymentSubmission: () => Promise<void>;
    Cal?: any;
    api?: any;
  }
}

const {
  lang = "es",
  title = "Amanah Academia - Aprende idiomas online",
  description = "Academia de idiomas online especializada en árabe y otros idiomas. Clases con profesores nativos.",
  canonical,
  ogImage,
  noindex,
  keywords,
  structuredDataType,
  structuredData,
} = Astro.props as PropsSEO;

const theme = Astro.cookies.get("theme")?.value;
---

<!doctype html>
<html lang={lang} class={`m-0 w-full h-full ${theme ? ` ${theme}` : ""}`}>
  <head>
    <script>
      // Solo aplica si no hay cookie de tema
      if (
        !document.documentElement.classList.contains("dark") &&
        !document.documentElement.classList.contains("light")
      ) {
        const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        document.documentElement.classList.add(prefersDark ? "dark" : "light");
      }
    </script>
    <!-- Preloads -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://challenges.cloudflare.com" />
    <link rel="dns-prefetch" href="https://apis.google.com" />

    <!-- Codificacion -->
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <!-- Favicon clásico para compatibilidad total -->
    <link rel="icon" type="image/x-icon" href="/favicon/favicon.ico" />
    <!-- Favicon SVG (para navegadores que lo soporten) -->
    <link rel="icon" type="image/svg+xml" href="/favicon/favicon.svg" />
    <!-- PNG de fallback -->
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon/favicon-96x96.png" />
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="/favicon/apple-touch-icon.png" sizes="180x180" />
    <!-- Manifest PWA -->
    <link rel="manifest" href="/favicon/site.webmanifest" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- SEO Components -->
    <SEO
      title={title}
      description={description}
      canonical={canonical}
      ogImage={ogImage}
      noindex={noindex}
      keywords={keywords}
      structuredDataType={structuredDataType}
      structuredData={structuredData}
    />
  </head>
  <body class="m-0 w-full h-full bg-background">
    <slot />
    <Toaster
      client:load
      position="bottom-right"
      gutter={64}
      toastOptions={{
        duration: 5000,
      }}
    />
  </body>
</html>
<script>
  import { closeModalsEvents } from "../utils/modals";

  document.addEventListener("DOMContentLoaded", () => {
    closeModalsEvents();
    // Botón para volver al inicio
    const backToTopButton = document.getElementById("backToTop");

    if (backToTopButton) {
      window.addEventListener("scroll", () => {
        if (window.pageYOffset > 300) {
          backToTopButton.classList.remove("opacity-0", "invisible");
          backToTopButton.classList.add("opacity-100", "visible");
        } else {
          backToTopButton.classList.remove("opacity-100", "visible");
          backToTopButton.classList.add("opacity-0", "invisible");
        }
      });

      backToTopButton.addEventListener("click", () => {
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      });
    }
    // Animacion de fade-in al hacer scroll
    const elements = document.querySelectorAll(".scroll-fade-in");
    const observer = new IntersectionObserver(
      (entries) => {
        entries.forEach((entry) => {
          if (entry.isIntersecting) entry.target.classList.add("visible");
        });
      },
      { threshold: 0 }
    );

    elements.forEach((el) => observer.observe(el));
  });
</script>
