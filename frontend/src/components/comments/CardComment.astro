---
import type { Comment } from "@/types/bakend-types";
import StarGroup from "./StarGroup.astro";
import Like from "@/assets/like.svg";
import Avatar from "../common/Avatar.astro";
import type { AvatarProps } from "@/types/types";

const comment = Astro.props.data as Comment;
if (!comment) return;

const avatar: AvatarProps = {
  name: comment.name ?? "Invitado",
  url_img: comment.url_img ?? "",
};
---

<div class="bg-lightSalmon max-w-sm rounded-lg scroll-fade-in min-w-72 overflow-hidden flex flex-col h-full">
  <!-- Header compacto -->
  <div class="p-4">
    <div class="flex items-center space-x-3">
      <!-- Avatar pequeño -->
      <Avatar info={avatar} />

      <!-- Info del usuario compacta -->
      <div class="flex-1 min-w-0">
        <div class="flex items-center justify-between">
          <h5 class="text-sm font-medium truncate">
            @{comment.name}
          </h5>
          <time class="text-xs ml-2">
            {comment.timestamp}
          </time>
        </div>
        <div class="mt-0.5 flex items-start">
          <StarGroup star={comment.stars} size={"12px"} />
        </div>
      </div>
    </div>

    <!-- Contenido del comentario -->
    <div class="mt-3">
      <p class="text-[var(-text-gray-800)] text-sm leading-snug line-clamp-3">
        {comment.content}
      </p>
    </div>
  </div>

  <!-- Footer minimalista -->
  <div class="px-4 py-1 bg-salmon mt-auto">
    <div class="flex items-center justify-end">
      <!-- Botón de like compacto -->
      <button
        class="flex items-center space-x-1 px-2 py-1 rounded-md hover:bg-[var(--color-light-red)] transition-colors duration-200 like-icon cursor-pointer"
        data-id={comment.author_uid}
        data-users-liked={JSON.stringify(comment.users_liked ?? [])}
      >
        <Like
          class="w-3.5 h-3.5 text-[var(--text-medium-contrast)] hover:text-[var(--color-red)] transition-colors duration-200 like-svg"
        />
        <span class="text-xs font-medium text-[var(--text-medium-contrast)] min-w-3 text-center">
          {(comment.like ?? 0) || 0}
        </span>
      </button>
    </div>
  </div>
</div>
<style>
  .like-svg {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    color: #6b7280;
    fill: #cbcbcb;
  }

  .like-icon.liked .like-svg,
  .like-svg.liked {
    color: var(--color-red);
    fill: var(--color-light-red);
    animation: likeAnimation 0.6s ease-in-out;
  }

  .like-svg:hover {
    color: var(--color-red);
    transform: scale(1.1);
  }

  .like-svg.pulse {
    animation: pulseEffect 0.3s ease-out;
  }

  @keyframes likeAnimation {
    0% {
      transform: scale(1);
    }
    15% {
      transform: scale(1.2);
    }
    30% {
      transform: scale(0.95);
    }
    45% {
      transform: scale(1.1);
    }
    60% {
      transform: scale(0.98);
    }
    100% {
      transform: scale(1);
    }
  }
  @keyframes pulseEffect {
    0% {
      transform: scale(1);
    }
    50% {
      transform: scale(1.3);
    }
    100% {
      transform: scale(1);
    }
  }
</style>
