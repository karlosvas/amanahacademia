---
import ThemeIcon from "@/assets/theme.svg";
---

<!-- Agregar id al componente -->
<div id="theme" class="cursor-pointer">
  <ThemeIcon />
</div>

<script>
  import { readThemeCookie, applyTheme } from "@/utils/cookie";

  document.addEventListener("DOMContentLoaded", () => {
    const themeButton = document.getElementById("theme");
    // Exponer helper global por si otros módulos lo usan
    window.setTheme = applyTheme;

    // Inicialización: lee cookie, si no existe usa preferencia y guarda cookie
    const cookieTheme = readThemeCookie();
    if (cookieTheme) {
      applyTheme(cookieTheme);
    } else {
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      applyTheme(prefersDark ? "dark" : "light");
    }

    // Toggle desde el botón del UI
    if (themeButton) {
      themeButton.addEventListener("click", () => {
        const current = document.documentElement.classList.contains("dark") ? "dark" : "light";
        const next = current === "dark" ? "light" : "dark";
        applyTheme(next);
      });
    }
  });
</script>
