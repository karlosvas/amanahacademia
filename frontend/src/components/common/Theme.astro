---
import ThemeIcon from "@/assets/theme.svg";
---

<!-- Agregar id al componente -->
<div id="theme" class="cursor-pointer">
  <ThemeIcon />
</div>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    const body = document.body;
    const html = document.documentElement;
    const themeButton = document.getElementById("theme");

    // Sincroniza body con html al cargar
    if (html.classList.contains("dark")) {
      body.className = "dark";
    } else if (html.classList.contains("light")) {
      body.className = "light";
    }

    // Aplica el tema claro o oscuro a la imagen
    function applyTheme(newTheme: "dark" | "light") {
      body.className = newTheme;
      html.classList.toggle("dark", newTheme === "dark");
      html.classList.toggle("light", newTheme === "light");

      // Opcional: recargar el logo si depende del tema
      const logo = document.getElementById("logo_amanah");
      if (logo && logo instanceof HTMLImageElement)
        logo.src = newTheme === "dark" ? "/img/logo_amanah_dark.webp" : "/img/logo_amanah.webp";
    }

    if (themeButton) {
      themeButton.addEventListener("click", async () => {
        // Usa body.className para saber el tema actual
        const currentTheme = body.className === "dark" ? "dark" : "light";
        const newTheme = currentTheme === "light" ? "dark" : "light";
        applyTheme(newTheme);

        // Guardar en Astro cookies v√≠a endpoint SSR
        await fetch("/api/set-theme", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ theme: newTheme }),
        });
      });
    }
  });
</script>
