---
import TraductorIcon from "@/assets/traductor.svg";

const customStyle = (Astro.props.customStyle || "bg-salmon") as string;
---

<button id="btnTraductor">
  <TraductorIcon />
</button>
<div
  id="bocadilloTraductor"
  class={`${customStyle} h-40 w-32 absolute text-sm top-16 right-4 rounded-md flex items-center justify-center text-white hidden z-50 font-jomolhari font-normal`}
>
  <ul>
    <li><a href="#" data-lang="ar" class="hover:text-red">العربية</a></li>
    <li><a href="#" data-lang="de" class="hover:text-red">Deutsch</a></li>
    <li><a href="#" data-lang="en" class="hover:text-red">English</a></li>
    <li><a href="#" data-lang="es" class="hover:text-red">Español</a></li>
    <li><a href="#" data-lang="fr" class="hover:text-red">Français</a></li>
    <li><a href="#" data-lang="it" class="hover:text-red">Italiano</a></li>
    <li><a href="#" data-lang="pt" class="hover:text-red">Português</a></li>
  </ul>
</div>
<div
  id="trianguloTraductor"
  class="absolute top-[3.5rem] right-8 w-0 h-0 hidden z-50"
  style={customStyle == "bg-salmon"
    ? "border-left: 12px solid transparent; border-right: 12px solid transparent; border-bottom: 12px solid var(--color-salmon);"
    : "border-left: 12px solid transparent; border-right: 12px solid transparent; border-bottom: 12px solid #374151;"}
>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btnTraductor = document.getElementById("btnTraductor");
    const bocadilloTraductor = document.getElementById("bocadilloTraductor");
    const trianguloTraductor = document.getElementById("trianguloTraductor");

    if (btnTraductor && bocadilloTraductor && trianguloTraductor) {
      btnTraductor.addEventListener("click", function (e) {
        e.stopPropagation();
        bocadilloTraductor.classList.toggle("hidden");
        trianguloTraductor.classList.toggle("hidden");
      });

      // Manejar clics en los enlaces de idioma
      bocadilloTraductor.addEventListener("click", function (e) {
        if (e.target && (e.target as HTMLElement).tagName === "A") {
          e.preventDefault();
          const lang = (e.target as HTMLElement).getAttribute("data-lang");
          const currentPath = window.location.pathname; // Quitar el + "/"

          // Remover el prefijo de idioma actual si existe
          const pathWithoutLang = currentPath.replace(/^\/(ar|de|en|fr|it|pt)\//, "/");

          // Construir nueva URL
          let newPath;
          if (lang === "es") {
            newPath = pathWithoutLang || "/";
          } else {
            newPath = `/${lang}${pathWithoutLang || "/"}`;
          }

          // Limpiar dobles barras
          newPath = newPath.replace(/\/+/g, "/");

          window.location.href = newPath;
        }
      });
    }

    document.addEventListener("click", function (e) {
      if (
        bocadilloTraductor &&
        trianguloTraductor &&
        btnTraductor &&
        !bocadilloTraductor.classList.contains("hidden") &&
        !btnTraductor.contains(e.target as Node) &&
        !bocadilloTraductor.contains(e.target as Node) &&
        !trianguloTraductor.contains(e.target as Node)
      ) {
        bocadilloTraductor.classList.add("hidden");
        trianguloTraductor.classList.add("hidden");
      }
    });
  });
</script>
