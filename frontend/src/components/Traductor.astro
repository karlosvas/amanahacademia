---
import TraductorIcon from "@/assets/traductor.svg";
---

<button id="btnTraductor">
  <TraductorIcon />
</button>
<div
  id="bocadilloTraductor"
  class="bg-[--color-salmon] h-40 w-32 absolute text-sm top-16 right-4 rounded-md flex items-center justify-center text-white hidden z-50"
>
  <ul>
    <li><a href="#" data-lang="ar">Árabe</a></li>
    <li><a href="#" data-lang="de">Alemán</a></li>
    <li><a href="#" data-lang="en">Inglés</a></li>
    <li><a href="#" data-lang="es">Español</a></li>
    <li><a href="#" data-lang="fr">Francés</a></li>
    <li><a href="#" data-lang="it">Italiano</a></li>
    <li><a href="#" data-lang="pt">Portugués</a></li>
  </ul>
</div>
<div
  id="trianguloTraductor"
  class="absolute top-[3.5rem] right-8 w-0 h-0 hidden z-50"
  style="
    border-left: 12px solid transparent;
    border-right: 12px solid transparent;
    border-bottom: 12px solid var(--color-salmon); 
  "
>
</div>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const btnTraductor = document.getElementById("btnTraductor");
    const bocadilloTraductor = document.getElementById("bocadilloTraductor");
    const trianguloTraductor = document.getElementById("trianguloTraductor");

    if (btnTraductor && bocadilloTraductor && trianguloTraductor) {
      btnTraductor.addEventListener("click", function (e) {
        e.stopPropagation();
        bocadilloTraductor.classList.toggle("hidden");
        trianguloTraductor.classList.toggle("hidden");
      });

      // Manejar clics en los enlaces de idioma
      bocadilloTraductor.addEventListener("click", function (e) {
        if (e.target && (e.target as HTMLElement).tagName === "A") {
          e.preventDefault();
          const lang = (e.target as HTMLElement).getAttribute("data-lang");
          const currentPath = window.location.pathname; // Quitar el + "/"

          // Remover el prefijo de idioma actual si existe
          const pathWithoutLang = currentPath.replace(/^\/(ar|de|en|fr|it|pt)\//, "/");

          // Construir nueva URL
          let newPath;
          if (lang === "es") {
            newPath = pathWithoutLang || "/";
          } else {
            newPath = `/${lang}${pathWithoutLang || "/"}`;
          }

          // Limpiar dobles barras
          newPath = newPath.replace(/\/+/g, "/");

          window.location.href = newPath;
        }
      });
    }

    document.addEventListener("click", function (e) {
      if (
        bocadilloTraductor &&
        trianguloTraductor &&
        btnTraductor &&
        !bocadilloTraductor.classList.contains("hidden") &&
        !btnTraductor.contains(e.target as Node) &&
        !bocadilloTraductor.contains(e.target as Node) &&
        !trianguloTraductor.contains(e.target as Node)
      ) {
        bocadilloTraductor.classList.add("hidden");
        trianguloTraductor.classList.add("hidden");
      }
    });
  });
</script>
